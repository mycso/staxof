{"ast":null,"code":"import _Reflect$construct from \"@babel/runtime-corejs2/core-js/reflect/construct\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _taggedTemplateLiteral from \"@babel/runtime-corejs2/helpers/esm/taggedTemplateLiteral\";\nvar _jsxFileName = \"C:\\\\Users\\\\Michael\\\\Documents\\\\reactJS\\\\stax-of-stories\\\\stax-shop\\\\Advanced-React\\\\stax\\\\frontend\\\\components\\\\DeleteItem.js\";\n\nfunction _createSuper(Derived) { return function () { var Super = _getPrototypeOf(Derived), result; if (_isNativeReflectConstruct()) { var NewTarget = _getPrototypeOf(this).constructor; result = _Reflect$construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !_Reflect$construct) return false; if (_Reflect$construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(_Reflect$construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n\\tmutation DELETE_ITEM_MUTATION($id: ID!) {\\n\\t\\tdeleteItem(id: $id) {\\n\\t\\t\\tid\\n\\t\\t}\\n\\t}\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { Component } from 'react';\nimport ItemStyles from './styles/ItemStyles';\nimport { Mutation } from 'react-apollo';\nimport gql from 'graphql-tag';\nimport { ALL_ITEMS_QUERY } from './Items';\nvar DELETE_ITEM_MUTATION = gql(_templateObject());\n\nvar DeleteItem = /*#__PURE__*/function (_Component) {\n  _inherits(DeleteItem, _Component);\n\n  var _super = _createSuper(DeleteItem);\n\n  function DeleteItem() {\n    var _this;\n\n    _classCallCheck(this, DeleteItem);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"update\", function (cache, payload) {\n      // manually update the cache on the client, so it matches the server\n      // 1. Read the cahe for the items we want\n      var data = cache.readQuery({\n        query: ALL_ITEMS_QUERY\n      });\n      console.log(data, payload); // 2. Filter the deleted itemout of the page\n\n      var filteredItems = data.items.filter(function (item) {\n        return item.id !== payload.data.deleteItem.id;\n      }); // 3. Put the items back!\n\n      cache.writeQuery({\n        query: ALL_ITEMS_QUERY,\n        data: {\n          items: filteredItems\n        }\n      });\n      Router.back();\n    });\n\n    return _this;\n  }\n\n  _createClass(DeleteItem, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return /*#__PURE__*/React.createElement(Mutation, {\n        mutation: DELETE_ITEM_MUTATION,\n        variables: {\n          id: this.props.id\n        },\n        update: this.update,\n        refetchQueries: [{\n          query: ALL_ITEMS_QUERY\n        }],\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 30,\n          columnNumber: 4\n        }\n      }, function (deleteItem, _ref) {\n        var error = _ref.error;\n        return /*#__PURE__*/React.createElement(\"button\", {\n          onClick: function onClick() {\n            if (confirm('Are you sure you want to delete this item?')) {\n              deleteItem()[\"catch\"](function (err) {\n                alert(err.message);\n              });\n            }\n          },\n          className: \"btn btn-warning\",\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 37,\n            columnNumber: 6\n          }\n        }, _this2.props.children);\n      });\n    }\n  }]);\n\n  return DeleteItem;\n}(Component);\n\nexport default DeleteItem;","map":{"version":3,"sources":["C:/Users/Michael/Documents/reactJS/stax-of-stories/stax-shop/Advanced-React/stax/frontend/components/DeleteItem.js"],"names":["React","Component","ItemStyles","Mutation","gql","ALL_ITEMS_QUERY","DELETE_ITEM_MUTATION","DeleteItem","cache","payload","data","readQuery","query","console","log","filteredItems","items","filter","item","id","deleteItem","writeQuery","Router","back","props","update","error","confirm","err","alert","message","children"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,OAAOC,UAAP,MAAuB,qBAAvB;AACA,SAASC,QAAT,QAAyB,cAAzB;AACA,OAAOC,GAAP,MAAgB,aAAhB;AACA,SAASC,eAAT,QAAgC,SAAhC;AAEA,IAAMC,oBAAoB,GAAGF,GAAH,mBAA1B;;IAQMG,U;;;;;;;;;;;;;;;;6DACI,UAACC,KAAD,EAAQC,OAAR,EAAoB;AAC5B;AACA;AACA,UAAMC,IAAI,GAAGF,KAAK,CAACG,SAAN,CAAgB;AAAEC,QAAAA,KAAK,EAAEP;AAAT,OAAhB,CAAb;AACAQ,MAAAA,OAAO,CAACC,GAAR,CAAYJ,IAAZ,EAAkBD,OAAlB,EAJ4B,CAK5B;;AACA,UAAMM,aAAa,GAAGL,IAAI,CAACM,KAAL,CAAWC,MAAX,CAAkB,UAAAC,IAAI;AAAA,eAAIA,IAAI,CAACC,EAAL,KAChDV,OAAO,CAACC,IAAR,CAAaU,UAAb,CAAwBD,EADoB;AAAA,OAAtB,CAAtB,CAN4B,CAQ5B;;AACAX,MAAAA,KAAK,CAACa,UAAN,CAAiB;AAAET,QAAAA,KAAK,EAAEP,eAAT;AAA0BK,QAAAA,IAAI,EAAE;AAAEM,UAAAA,KAAK,EAAED;AAAT;AAAhC,OAAjB;AACAO,MAAAA,MAAM,CAACC,IAAP;AACA,K;;;;;;;6BACQ;AAAA;;AACR,0BACC,oBAAC,QAAD;AACC,QAAA,QAAQ,EAAEjB,oBADX;AAEC,QAAA,SAAS,EAAE;AAAEa,UAAAA,EAAE,EAAE,KAAKK,KAAL,CAAWL;AAAjB,SAFZ;AAGC,QAAA,MAAM,EAAE,KAAKM,MAHd;AAIC,QAAA,cAAc,EAAE,CAAC;AAAEb,UAAAA,KAAK,EAAEP;AAAT,SAAD,CAJjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAME,UAACe,UAAD;AAAA,YAAeM,KAAf,QAAeA,KAAf;AAAA,4BACA;AAAQ,UAAA,OAAO,EAAE,mBAAM;AACtB,gBAAIC,OAAO,CAAC,4CAAD,CAAX,EAA2D;AAC1DP,cAAAA,UAAU,WAAV,CAAmB,UAAAQ,GAAG,EAAI;AACzBC,gBAAAA,KAAK,CAACD,GAAG,CAACE,OAAL,CAAL;AACA,eAFD;AAGA;AACD,WAND;AAMG,UAAA,SAAS,EAAC,iBANb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAOE,MAAI,CAACN,KAAL,CAAWO,QAPb,CADA;AAAA,OANF,CADD;AAoBA;;;;EAlCuB9B,S;;AAqCzB,eAAeM,UAAf","sourcesContent":["import React, { Component } from 'react';\r\nimport ItemStyles from './styles/ItemStyles';\r\nimport { Mutation } from 'react-apollo';\r\nimport gql from 'graphql-tag';\r\nimport { ALL_ITEMS_QUERY } from './Items';\r\n\r\nconst DELETE_ITEM_MUTATION = gql`\r\n\tmutation DELETE_ITEM_MUTATION($id: ID!) {\r\n\t\tdeleteItem(id: $id) {\r\n\t\t\tid\r\n\t\t}\r\n\t}\r\n`;\r\n\r\nclass DeleteItem extends Component {\r\n\tupdate = (cache, payload) => {\r\n\t\t// manually update the cache on the client, so it matches the server\r\n\t\t// 1. Read the cahe for the items we want\r\n\t\tconst data = cache.readQuery({ query: ALL_ITEMS_QUERY });\r\n\t\tconsole.log(data, payload);\r\n\t\t// 2. Filter the deleted itemout of the page\r\n\t\tconst filteredItems = data.items.filter(item => item.id !== \r\n\t\tpayload.data.deleteItem.id);\r\n\t\t// 3. Put the items back!\r\n\t\tcache.writeQuery({ query: ALL_ITEMS_QUERY, data: { items: filteredItems } });\r\n\t\tRouter.back();\r\n\t};\r\n\trender() {\r\n\t\treturn ( \r\n\t\t\t<Mutation \r\n\t\t\t\tmutation={DELETE_ITEM_MUTATION} \r\n\t\t\t\tvariables={{ id: this.props.id }}\r\n\t\t\t\tupdate={this.update}\r\n\t\t\t\trefetchQueries={[{ query: ALL_ITEMS_QUERY }]}\r\n\t\t\t>\r\n\t\t\t\t{(deleteItem, { error }) => (\r\n\t\t\t\t\t<button onClick={() => {\r\n\t\t\t\t\t\tif (confirm('Are you sure you want to delete this item?')) {\r\n\t\t\t\t\t\t\tdeleteItem().catch(err => {\r\n\t\t\t\t\t\t\t\talert(err.message);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}} className=\"btn btn-warning\">\r\n\t\t\t\t\t\t{this.props.children}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t)}\r\n\t\t\t</Mutation>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default DeleteItem;"]},"metadata":{},"sourceType":"module"}