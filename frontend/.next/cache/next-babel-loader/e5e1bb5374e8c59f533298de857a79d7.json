{"ast":null,"code":"import _Reflect$construct from \"@babel/runtime-corejs2/core-js/reflect/construct\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _taggedTemplateLiteral from \"@babel/runtime-corejs2/helpers/esm/taggedTemplateLiteral\";\nvar _jsxFileName = \"C:\\\\Users\\\\Michael\\\\Documents\\\\reactJS\\\\stax-of-stories\\\\stax-shop\\\\Advanced-React\\\\stax\\\\frontend\\\\components\\\\TakeMyMoney.js\";\n\nfunction _createSuper(Derived) { return function () { var Super = _getPrototypeOf(Derived), result; if (_isNativeReflectConstruct()) { var NewTarget = _getPrototypeOf(this).constructor; result = _Reflect$construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !_Reflect$construct) return false; if (_Reflect$construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(_Reflect$construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n\\tmutation createOrder($token: String!) {\\n\\t\\tcreateOrder(token: $token) {\\n\\t\\t\\tid\\n\\t\\t\\tcharge\\n\\t\\t\\ttotal\\n\\t\\t\\titems {\\n\\t\\t\\t\\tid\\n\\t\\t\\t\\ttitle\\n\\t\\t\\t}\\n\\t\\t}\\n\\t}\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React from 'react';\nimport StripeCheckout from 'react-stripe-checkout';\nimport { Elements } from '@stripe/react-stripe-js';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { Mutation } from 'react-apollo';\nimport Router from 'next/router';\nimport NProgress from 'nprogress';\nimport PropTypes from 'prop-types';\nimport gql from 'graphql-tag';\nimport CartStyles from './styles/CartStyles';\nimport calcTotalPrice from '../lib/calcTotalPrice';\nimport formatMoney from '../lib/formatMoney';\nimport Error from './ErrorMessage';\nimport User, { CURRENT_USER_QUERY } from './User';\nvar CREATE_ORDER_MUTATION = gql(_templateObject()); // function totalItems(cart) {\n// \treturn cart.reduce((tally, cartItem) => tally + cartItem.quantity * cartItem.item.price + cartItem.item.deliveryCost, 0);\n// }\n\nfunction totalItems(cart) {\n  return cart.reduce(function (tally, cartItem) {\n    return tally + cartItem.quantity * cartItem.item.price;\n  }, 0);\n}\n\nvar TakeMymoney = /*#__PURE__*/function (_React$Component) {\n  _inherits(TakeMymoney, _React$Component);\n\n  var _super = _createSuper(TakeMymoney);\n\n  function TakeMymoney() {\n    var _this;\n\n    _classCallCheck(this, TakeMymoney);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"onToken\", /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(res, createOrder) {\n        var order;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                NProgress.start(); // manually call the mutation once we have the stripe token\n\n                _context.next = 3;\n                return createOrder({\n                  variables: {\n                    token: res.id\n                  }\n                })[\"catch\"](function (err) {\n                  alert(err.message);\n                });\n\n              case 3:\n                order = _context.sent;\n                console.log(createOrder);\n                Router.push({\n                  pathname: '/order',\n                  query: {\n                    id: order.data.createOrder.id\n                  }\n                });\n\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x, _x2) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n\n    return _this;\n  }\n\n  _createClass(TakeMymoney, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return /*#__PURE__*/React.createElement(User, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 58,\n          columnNumber: 4\n        }\n      }, function (_ref2) {\n        var me = _ref2.data.me,\n            loading = _ref2.loading;\n        if (loading) return null;\n        return /*#__PURE__*/React.createElement(Mutation, {\n          mutation: CREATE_ORDER_MUTATION,\n          refetchQueries: [{\n            query: CURRENT_USER_QUERY\n          }],\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 62,\n            columnNumber: 6\n          }\n        }, function (createOrder) {\n          return /*#__PURE__*/React.createElement(StripeCheckout, {\n            amount: calcTotalPrice(me.cart),\n            description: \"Order of \".concat(formatMoney(totalItems(me.cart)), \" items!\"),\n            image: me.cart.length && me.cart[0].item && me.cart[0].item.image,\n            stripeKey: \"pk_live_5LZMQxzqkd7Oz7MOQJCV5fqx00C6nInitL\" // stripeKey=\"pk_test_lJw4vC96fbQWPRUPZ7pTrsd100KKkQ0fKR\"\n            ,\n            shippingAddress: true,\n            billingAddress: true,\n            shippingMethods: true,\n            panelLabel: \"Total\",\n            currency: \"GBP\",\n            name: me.name,\n            email: me.email,\n            locale: \"auto\",\n            receipt_email: me.email,\n            token: function token(res) {\n              return _this2.onToken(res, createOrder);\n            },\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 66,\n              columnNumber: 7\n            }\n          }, _this2.props.children);\n        });\n      });\n    }\n  }]);\n\n  return TakeMymoney;\n}(React.Component);\n\nexport default TakeMymoney;\nexport { CREATE_ORDER_MUTATION };","map":{"version":3,"sources":["C:/Users/Michael/Documents/reactJS/stax-of-stories/stax-shop/Advanced-React/stax/frontend/components/TakeMyMoney.js"],"names":["React","StripeCheckout","Elements","loadStripe","Mutation","Router","NProgress","PropTypes","gql","CartStyles","calcTotalPrice","formatMoney","Error","User","CURRENT_USER_QUERY","CREATE_ORDER_MUTATION","totalItems","cart","reduce","tally","cartItem","quantity","item","price","TakeMymoney","res","createOrder","start","variables","token","id","err","alert","message","order","console","log","push","pathname","query","data","me","loading","length","image","name","email","onToken","props","children","Component"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,cAAP,MAA2B,uBAA3B;AACA,SAASC,QAAT,QAAyB,yBAAzB;AACA,SAASC,UAAT,QAA2B,mBAA3B;AACA,SAASC,QAAT,QAAyB,cAAzB;AACA,OAAOC,MAAP,MAAmB,aAAnB;AACA,OAAOC,SAAP,MAAsB,WAAtB;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,OAAOC,GAAP,MAAgB,aAAhB;AACA,OAAOC,UAAP,MAAuB,qBAAvB;AACA,OAAOC,cAAP,MAA2B,uBAA3B;AACA,OAAOC,WAAP,MAAwB,oBAAxB;AACA,OAAOC,KAAP,MAAkB,gBAAlB;AACA,OAAOC,IAAP,IAAeC,kBAAf,QAAyC,QAAzC;AAEA,IAAMC,qBAAqB,GAAGP,GAAH,mBAA3B,C,CAcA;AACA;AACA;;AAEA,SAASQ,UAAT,CAAoBC,IAApB,EAA0B;AACzB,SAAOA,IAAI,CAACC,MAAL,CAAY,UAACC,KAAD,EAAQC,QAAR;AAAA,WAAqBD,KAAK,GAAGC,QAAQ,CAACC,QAAT,GAAoBD,QAAQ,CAACE,IAAT,CAAcC,KAA/D;AAAA,GAAZ,EAAkF,CAAlF,CAAP;AACA;;IAEKC,W;;;;;;;;;;;;;;;;;0EACK,iBAAOC,GAAP,EAAYC,WAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AACTpB,gBAAAA,SAAS,CAACqB,KAAV,GADS,CAET;;AAFS;AAAA,uBAGWD,WAAW,CAAC;AAC/BE,kBAAAA,SAAS,EAAE;AACVC,oBAAAA,KAAK,EAAEJ,GAAG,CAACK;AADD;AADoB,iBAAD,CAAX,UAIX,UAAAC,GAAG,EAAI;AACfC,kBAAAA,KAAK,CAACD,GAAG,CAACE,OAAL,CAAL;AACA,iBANmB,CAHX;;AAAA;AAGHC,gBAAAA,KAHG;AAUTC,gBAAAA,OAAO,CAACC,GAAR,CAAYV,WAAZ;AACArB,gBAAAA,MAAM,CAACgC,IAAP,CAAY;AACXC,kBAAAA,QAAQ,EAAE,QADC;AAEXC,kBAAAA,KAAK,EAAE;AAAET,oBAAAA,EAAE,EAAEI,KAAK,CAACM,IAAN,CAAWd,WAAX,CAAuBI;AAA7B;AAFI,iBAAZ;;AAXS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,O;;;;;;;;;;;;6BAiBD;AAAA;;AACR,0BACC,oBAAC,IAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,iBAA+B;AAAA,YAApBW,EAAoB,SAA5BD,IAA4B,CAApBC,EAAoB;AAAA,YAAdC,OAAc,SAAdA,OAAc;AAChC,YAAGA,OAAH,EAAY,OAAO,IAAP;AACZ,4BACC,oBAAC,QAAD;AACA,UAAA,QAAQ,EAAE3B,qBADV;AAEA,UAAA,cAAc,EAAE,CAAC;AAAEwB,YAAAA,KAAK,EAAEzB;AAAT,WAAD,CAFhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAGC,UAAAY,WAAW;AAAA,8BACX,oBAAC,cAAD;AACC,YAAA,MAAM,EAAEhB,cAAc,CAAC+B,EAAE,CAACxB,IAAJ,CADvB;AAEC,YAAA,WAAW,qBAAcN,WAAW,CAACK,UAAU,CAACyB,EAAE,CAACxB,IAAJ,CAAX,CAAzB,YAFZ;AAGC,YAAA,KAAK,EAAEwB,EAAE,CAACxB,IAAH,CAAQ0B,MAAR,IAAkBF,EAAE,CAACxB,IAAH,CAAQ,CAAR,EAAWK,IAA7B,IAAqCmB,EAAE,CAACxB,IAAH,CAAQ,CAAR,EAAWK,IAAX,CAAgBsB,KAH7D;AAIC,YAAA,SAAS,EAAC,4CAJX,CAKC;AALD;AAMC,YAAA,eAAe,MANhB;AAOC,YAAA,cAAc,MAPf;AAQC,YAAA,eAAe,MARhB;AASC,YAAA,UAAU,EAAC,OATZ;AAUC,YAAA,QAAQ,EAAC,KAVV;AAWC,YAAA,IAAI,EAAEH,EAAE,CAACI,IAXV;AAYC,YAAA,KAAK,EAAEJ,EAAE,CAACK,KAZX;AAaC,YAAA,MAAM,EAAC,MAbR;AAcC,YAAA,aAAa,EAAEL,EAAE,CAACK,KAdnB;AAeC,YAAA,KAAK,EAAE,eAAArB,GAAG;AAAA,qBAAI,MAAI,CAACsB,OAAL,CAAatB,GAAb,EAAkBC,WAAlB,CAAJ;AAAA,aAfX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAiBE,MAAI,CAACsB,KAAL,CAAWC,QAjBb,CADW;AAAA,SAHZ,CADD;AA2BC,OA9BF,CADD;AAkCA;;;;EArDwBjD,KAAK,CAACkD,S;;AAyDhC,eAAe1B,WAAf;AACA,SAAST,qBAAT","sourcesContent":["import React from 'react';\r\nimport StripeCheckout from 'react-stripe-checkout';\r\nimport { Elements } from '@stripe/react-stripe-js';\r\nimport { loadStripe } from '@stripe/stripe-js';\r\nimport { Mutation } from 'react-apollo';\r\nimport Router from 'next/router';\r\nimport NProgress from 'nprogress';\r\nimport PropTypes from 'prop-types';\r\nimport gql from 'graphql-tag';\r\nimport CartStyles from './styles/CartStyles';\r\nimport calcTotalPrice from '../lib/calcTotalPrice';\r\nimport formatMoney from '../lib/formatMoney';\r\nimport Error from './ErrorMessage';\r\nimport User, { CURRENT_USER_QUERY } from './User';\r\n\r\nconst CREATE_ORDER_MUTATION = gql`\r\n\tmutation createOrder($token: String!) {\r\n\t\tcreateOrder(token: $token) {\r\n\t\t\tid\r\n\t\t\tcharge\r\n\t\t\ttotal\r\n\t\t\titems {\r\n\t\t\t\tid\r\n\t\t\t\ttitle\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n`;\r\n\r\n// function totalItems(cart) {\r\n// \treturn cart.reduce((tally, cartItem) => tally + cartItem.quantity * cartItem.item.price + cartItem.item.deliveryCost, 0);\r\n// }\r\n\r\nfunction totalItems(cart) {\r\n\treturn cart.reduce((tally, cartItem) => tally + cartItem.quantity * cartItem.item.price, 0);\r\n}\r\n\r\nclass TakeMymoney extends React.Component {\r\n\tonToken = async (res, createOrder) => {\r\n\t\tNProgress.start()\r\n\t\t// manually call the mutation once we have the stripe token\r\n\t\tconst order = await createOrder({\r\n\t\t\tvariables: {\r\n\t\t\t\ttoken: res.id\r\n\t\t\t},\r\n\t\t}).catch(err => {\r\n\t\t\talert(err.message);\r\n\t\t});\r\n\t\tconsole.log(createOrder)\r\n\t\tRouter.push({\r\n\t\t\tpathname: '/order',\r\n\t\t\tquery: { id: order.data.createOrder.id },\r\n\t\t})\r\n\t};\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<User>\r\n\t\t\t\t{({ data: { me }, loading }) => {\r\n\t\t\t\tif(loading) return null;\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<Mutation\r\n\t\t\t\t\tmutation={CREATE_ORDER_MUTATION} \r\n\t\t\t\t\trefetchQueries={[{ query: CURRENT_USER_QUERY }]}>\r\n\t\t\t\t\t{createOrder => (\r\n\t\t\t\t\t\t<StripeCheckout \r\n\t\t\t\t\t\t\tamount={calcTotalPrice(me.cart)}\r\n\t\t\t\t\t\t\tdescription={`Order of ${formatMoney(totalItems(me.cart))} items!`}\r\n\t\t\t\t\t\t\timage={me.cart.length && me.cart[0].item && me.cart[0].item.image}\r\n\t\t\t\t\t\t\tstripeKey=\"pk_live_5LZMQxzqkd7Oz7MOQJCV5fqx00C6nInitL\"\r\n\t\t\t\t\t\t\t// stripeKey=\"pk_test_lJw4vC96fbQWPRUPZ7pTrsd100KKkQ0fKR\"\r\n\t\t\t\t\t\t\tshippingAddress\r\n\t\t\t\t\t\t\tbillingAddress\r\n\t\t\t\t\t\t\tshippingMethods\r\n\t\t\t\t\t\t\tpanelLabel=\"Total\"\r\n\t\t\t\t\t\t\tcurrency=\"GBP\"\r\n\t\t\t\t\t\t\tname={me.name}\r\n\t\t\t\t\t\t\temail={me.email}\r\n\t\t\t\t\t\t\tlocale=\"auto\"\r\n\t\t\t\t\t\t\treceipt_email={me.email}\r\n\t\t\t\t\t\t\ttoken={res => this.onToken(res, createOrder)}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{this.props.children}\r\n\t\t\t\t\t\t</StripeCheckout>\r\n\t\t\t\t\t)}\r\n\t\t\t\t\t</Mutation>\r\n\t\t\t\t\t)\r\n\t\t\t\t}}\r\n\t\t\t</User>\r\n\t\t);\r\n\t}\r\n}\r\n\r\n\r\nexport default TakeMymoney;\r\nexport { CREATE_ORDER_MUTATION }; "]},"metadata":{},"sourceType":"module"}